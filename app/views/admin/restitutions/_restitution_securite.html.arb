# frozen_string_literal: true

panel t('.restitution_securite') do
  attributes_table_for [
    [t('.valeur_utilisateur'), restitution],
    [t('.moyenne_glissante'), moyenne_glissante],
    [t('.ecart_type_glissant'), ecart_type_glissant],
    [t('.cote_z'), cote_z]
  ] do
    row do |(titre, _)|
      strong titre
    end
    row t('.temps_entrainement') do |(_, r)|
      Time.at(r.temps_entrainement).strftime('%M:%S') if r.temps_entrainement.present?
    end
    row t('.dangers_identifies') do |(_, r)|
      r.nombre_dangers_identifies
    end
    row t('.dangers_mal_identifies') do |(_, r)|
      r.nombre_danger_mal_identifies
    end
    row t('.dangers_identifies_avant_aide_1') do |(_, r)|
      r.nombre_dangers_identifies_avant_aide_1
    end
    row t('.dangers_bien_qualifies') do |(_, r)|
      r.nombre_bien_qualifies
    end
    row t('.retours_dangers_deja_qualifies') do |(_, r)|
      r.nombre_retours_deja_qualifies
    end
    row t('.temps_ouvertures_zones_dangers') do |_, r|
      r.temps_ouvertures_zones_dangers&.collect do |temps|
        Time.at(temps).strftime('%M:%S')
      end&.join(', ')
    end
    row t('.temps_moyen_ouvertures_zones_dangers') do |_, r|
      temps = r.temps_moyen_ouvertures_zones_dangers
      Time.at(temps).strftime('%M:%S') if temps.present?
    end
    row t('.attention_visuo_spatiale') do |_, r|
      if r.attention_visuo_spatiale.present?
        t(r.attention_visuo_spatiale, scope: 'admin.evaluations.restitution_competence')
      end
    end
    row t('.retours_zones_sans_danger') do |(_, r)|
      r.nombre_reouverture_zone_sans_danger
    end
  end
end
