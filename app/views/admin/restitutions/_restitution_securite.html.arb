# frozen_string_literal: true

panel t('.restitution_securite') do
  attributes_table_for [restitution, OpenStruct.new(restitution.partie.moyenne_metriques)] do
    row do |r|
      if r.is_a?(Restitution::Base)
        t('.valeur_utilisateur')
      else
        t('.moyenne')
      end
    end
    row t('.temps_entrainement') do |r|
      Time.at(r.temps_entrainement).strftime('%M:%S') if r.temps_entrainement.present?
    end
    row t('.dangers_identifies'), &:nombre_dangers_identifies
    row t('.dangers_identifies_avant_aide_1'), &:nombre_dangers_identifies_avant_aide_1
    row t('.dangers_bien_qualifies'), &:nombre_bien_qualifies
    row t('.retours_dangers_deja_qualifies'), &:nombre_retours_deja_qualifies
    row t('.temps_ouvertures_zones_dangers') do |r|
      r.temps_ouvertures_zones_dangers&.collect do |temps|
        Time.at(temps).strftime('%M:%S')
      end&.join(', ')
    end
    row t('.temps_moyen_ouvertures_zones_dangers') do |r|
      temps = r.temps_moyen_ouvertures_zones_dangers
      Time.at(temps).strftime('%M:%S') if temps.present?
    end
    row t('.attention_visuo_spatiale') do |restitution|
      t(restitution.attention_visuo_spatiale, scope: 'admin.evaluations.restitution_competence')
    end
    row t('.retours_zones_sans_danger'), &:nombre_reouverture_zone_sans_danger
  end
end
